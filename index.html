<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Truy xu·∫•t s·∫£n ph·∫©m</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; }
    input, button { padding: 10px; font-size: 16px; width: 100%; margin-bottom: 10px; }
    pre { background: #f7f7f7; padding: 15px; white-space: pre-wrap; }
  </style>
</head>
<body>

  <h2>üîç Truy xu·∫•t ngu·ªìn g·ªëc s·∫£n ph·∫©m</h2>
  <input id="productId" placeholder="Nh·∫≠p m√£ s·∫£n ph·∫©m (ho·∫∑c qu√©t QR)">
  <button onclick="truyXuat()">Truy xu·∫•t</button>
  <pre id="ketQua"></pre>

  <!-- ‚úÖ ethers.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

  <script>
    const CONTRACT_ADDRESS = "0xe762b6E85fb489683cA800Cc610Ae5Ca67d46C61";

    const ABI = [
      {
        "inputs": [
          { "internalType": "string", "name": "id", "type": "string" }
        ],
        "name": "getProduct",
        "outputs": [
          { "internalType": "string", "name": "rawMaterial", "type": "string" },
          { "internalType": "string", "name": "manufacturer", "type": "string" },
          { "internalType": "string", "name": "packageInfo", "type": "string" },
          { "internalType": "string", "name": "distributor", "type": "string" }
        ],
        "stateMutability": "view",
        "type": "function"
      }
    ];

    async function truyXuat() {
      const id = document.getElementById("productId").value;
      try {
        const provider = new ethers.providers.JsonRpcProvider("https://data-seed-prebsc-1-s1.binance.org:8545/");
        const contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, provider);
        const data = await contract.getProduct(id);
        document.getElementById("ketQua").textContent = `
üß™ Nguy√™n li·ªáu: ${data.rawMaterial}
üè≠ Nh√† s·∫£n xu·∫•t: ${data.manufacturer}
üì¶ Quy c√°ch: ${data.packageInfo}
üöö Ph√¢n ph·ªëi: ${data.distributor}
        `;
      } catch (err) {
        document.getElementById("ketQua").textContent = "Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m ho·∫∑c l·ªói k·∫øt n·ªëi.";
      }
    }

    // ‚úÖ T·ª± ƒë·ªông truy xu·∫•t khi c√≥ tham s·ªë ?productId=
    window.onload = () => {
      const params = new URLSearchParams(window.location.search);
      const id = params.get('productId');
      if (id) {
        document.getElementById("productId").value = id;
        truyXuat();
      }
    };
  </script>

</body>
</html>
